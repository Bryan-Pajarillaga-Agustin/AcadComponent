import{j as s,r as n,B as ne,c as M,f as J,h as K,i as Q,d as W,a as P,k as oe,l as re,b as q,g as ce,m as ie}from"./index-D4iUY_VG.js";const de="_foldersWrapper_16fzy_17",pe="_foldersBottomNav_16fzy_139",ue="_foldersBox_16fzy_199",fe="_folderPathWrapper_16fzy_211",he="_hideFolderInput_16fzy_241",me="_folderInput_16fzy_249",xe="_close_16fzy_249",je="_folder_16fzy_17",_e="_file_16fzy_259",Fe="_open_16fzy_315",ge="_selected_16fzy_379",i={foldersWrapper:de,foldersBottomNav:pe,foldersBox:ue,folderPathWrapper:fe,hideFolderInput:he,folderInput:me,close:xe,folder:je,file:_e,open:Fe,selected:ge},ye="_foldersBottomNav_1md3l_1",Ne="_left_1md3l_15",ve="_uncheck_1md3l_15",Ce="_right_1md3l_33",g={foldersBottomNav:ye,left:Ne,uncheck:ve,right:Ce},be=({deleteSelectedFolder:r,setSelecting:j,handleSelectingAll:p})=>s.jsxs("div",{className:g.foldersBottomNav,children:[s.jsxs("div",{className:g.left,children:[s.jsxs("button",{onClick:()=>{p(!0)},children:[s.jsx("i",{className:"fa fa-check"}),s.jsx("span",{className:g.fullContent,children:"Select All"})]}),s.jsxs("button",{onClick:()=>{p(!1)},children:[s.jsx("i",{className:`fa fa-check-square ${g.uncheck}`}),s.jsx("span",{className:g.fullContent,children:"Unselect All"})]})]}),s.jsxs("div",{className:g.right,children:[s.jsxs("button",{onClick:()=>{r()},children:[s.jsx("i",{className:"fa fa-trash"}),s.jsx("span",{className:g.fullContent,children:"Delete"})]}),s.jsxs("button",{onClick:()=>{j(!1),p(!1)},children:[s.jsx("i",{className:"fa fa-close"}),s.jsx("span",{className:g.fullContent,children:"Cancel"})]})]})]}),Be="_foldersNav_ae1hy_1",Se="_horizontalLine_ae1hy_19",ke="_right_ae1hy_47",$e="_uploadWrapper_ae1hy_65",w={foldersNav:Be,horizontalLine:Se,right:ke,uploadWrapper:$e},De="_uploaderWrapper_16u2b_1",Ie="_uploaderBox_16u2b_35",Ue="_uploaderBoxLabel_16u2b_61",we="_closeButton_16u2b_91",z={uploaderWrapper:De,uploaderBox:Ie,uploaderBoxLabel:Ue,closeButton:we},ze=({uploadFile:r,uploaderPrompt:j,setUploaderPrompt:p})=>{const v=n.useRef();if(j)return s.jsxs("div",{className:z.uploaderWrapper,children:[s.jsx("input",{type:"file",id:"fileUploader",accept:"*",ref:v,onChange:u=>{r(u.target.files)}}),s.jsxs("div",{className:z.uploaderBox,children:[s.jsx(ne,{icon:s.jsx("i",{className:"fa fa-close"}),className:z.closeButton,func:()=>{p(!1)}}),s.jsxs("label",{className:z.uploaderBoxLabel,htmlFor:"fileUploader",onDragOver:u=>{u.preventDefault()},onDrop:u=>{u.preventDefault(),r(u.dataTransfer.files)},children:[s.jsx("img",{src:"./Folder/cloudUpload.png",alt:""}),s.jsx("p",{children:"Click to Upload"}),s.jsx("p",{children:"or Drop Files to Upload"})]})]})]})},We=({setShowFolderInput:r})=>{const{user:j,setLoading:p,setFoldersCache:v}=n.useContext(M),{folderPath:u,setFilesAndFolders:R,filesAndFolders:O}=n.useContext(X),[B,C]=n.useState(!1),b=async y=>{var D,S;p(!0);const d=y;for(let c=0;c<d.length;c++){let k="qwertyuiopasdfghjklzxcvbnm",N="";for(let x=0;x<15;x++){let o=Math.floor(Math.random()*k.length);N=N.concat(k[o])}const _=J(Q,`${(D=K.currentUser)==null?void 0:D.uid}/${u}/${N+"_"+d[c].name}`),f=W(P,"Users",(S=K.currentUser)==null?void 0:S.uid);try{if(d[c]){let x=O;await oe(_,d[c]);const o=await re(_);R(F=>[{name:d[c].name,fileType:d[c].type,fullName:N+"_"+d[c].name,url:o,dateCreated:Date.now(),isSelected:!1,id:Math.random()*1,type:"file",path:u},...F]),x.push({name:d[c].name,fileType:d[c].type,fullName:N+"_"+d[c].name,url:o,dateCreated:Date.now(),isSelected:!1,id:Math.random()*1,type:"file",path:u}),v([...x]),await q(f,{folders:x})}}catch{console.log("No file selected."),p(!1)}}p(!1)};return s.jsxs("div",{className:w.foldersNav,children:[s.jsx("h1",{children:"Folders"}),s.jsxs("div",{className:w.right,children:[s.jsx("button",{children:"Create"}),s.jsxs("div",{className:w.uploadWrapper,children:[s.jsxs("button",{onClick:()=>{C(!0)},children:[s.jsx("i",{className:"fa fa-file"}),s.jsx("span",{children:"Upload File"})]}),s.jsxs("button",{onClick:()=>{r(!0)},children:[s.jsx("i",{className:"	fa fa-folder"}),s.jsx("label",{htmlFor:"folderInput",children:"Create Folder"})]})]})]}),s.jsx("span",{className:w.horizontalLine}),s.jsx(ze,{uploadFile:y=>{b(y)},uploaderPrompt:B,setUploaderPrompt:y=>{C(y)}})]})},X=n.createContext(),Re=()=>{const{user:r,setLoading:j,foldersCache:p,setFoldersCache:v}=n.useContext(M),{setPages:u,imageContent:R,setImageContent:O}=n.useContext(M),B=n.useRef(null),[C,b]=n.useState(null),[y,d]=n.useState(null),[D,S]=n.useState(!1),[c,k]=n.useState(!1),[N,_]=n.useState(!1),[f,x]=n.useState("Folders/"),[o,F]=n.useState(p),[L,I]=n.useState([]),[$,V]=n.useState([{name:"Folders",path:"Folders/"}]),[U,A]=n.useState([]);function Y(e){let t=o,l=[];for(let a in t)e.id==t[a].id&&(t[a].isSelected=!t[a].isSelected);for(let a in o)o[a].isSelected&&l.push(o[a]);console.log(),A([...l]),F([...t])}function Z(e){I(a=>a.map(h=>({...h,isSelected:!!e})));let t=o,l=[];for(let a in t)t[a].isSelected=!!e,e&&l.push(t[a].id);A([...l])}function G(e){console.log(f);const t={name:e.target.value,dateCreated:Date.now(),isSelected:!1,id:Math.floor(Math.random()*1e6),type:"folder",path:f},l=e.target.value;if(e.key=="Enter"){if(l!=""){let h=[t,...o];T(h),F(m=>[t,...m])}else _(!1);_(!1),e.target.value=""}}function ee(e,t){const l=e.target.value,a=e.key;let h=o;console.log(t.name),a=="Enter"&&(l!=""?(h=h.map(m=>t.name==m.name?{...m,name:l}:{...m}),T(h),F(m=>m.map(E=>t.name==E.name?{...E,name:l}:{...E}))):d(null),b(null))}function H(e){let t=[],l=$;if(console.log(l.length),l.length!=1){for(let a in t)t[a].path==f&&t.push(t[a]);for(let a in $)if($[a].path==e.path){for(let h=$.length-1;h!=a;h--)l.splice(h,1);break}V([...l]),I([...t])}}function se(e){if(e.type=="folder"){e!=null&&e.name&&x(f+(e==null?void 0:e.name)+"/"),V(l=>[...l,{name:e==null?void 0:e.name,path:(e==null?void 0:e.path)+(e==null?void 0:e.name)+"/"}]);let t=[];for(let l in t)t[l].path==f&&t.push(t[l]);I([...t])}else S(!0)}const te=async()=>{var t;let e=o;j(!0);try{for(let l in U)for(let a in e)U[l].id==e[a].id&&(U[l].type=="folder"||await ie(J(Q,`/${(t=K.currentUser)==null?void 0:t.uid}/${f}/${U[l].fullName}`)),e.splice(a,1));await q(W(P,"Users",r.uid),{folders:e})}catch(l){console.log(l)}A([]),F([...e]),j(!1)},T=async e=>{const t=W(P,"Users",r==null?void 0:r.uid);console.log(e),e&&v([...e]);try{await q(t,{folders:e||o})}catch(l){console.log(l)}};n.useEffect(()=>{if(f!=""){let e=[],t=[],l=[];for(let a in o)o[a].path===f&&e.push(o[a]);for(let a in e)e[a].type=="folders"?l.push(e[a]):t.push(e[a]);console.log(e),I([...l,...t])}},[f,o]),n.useEffect(()=>{if(p.length==0&&r){const e=async t=>{var l;j(!0);try{const a=W(P,"Users",t),m=(l=(await ce(a)).data())==null?void 0:l.folders;console.log(m),m&&(F([...m]),v([...m]))}catch(a){console.log(a)}j(!1)};r!=null&&r.uid&&e(r.uid)}},[p,r]),n.useEffect(()=>{u(e=>e.map(t=>t.name==="Folders"?{...t,ind:!0}:{...t,ind:!1}))},[]);const le={openFile:D,setOpenFile:S,imageContent:R,setImageContent:O,folderPath:f,setFilesAndFolders:F,filesAndFolders:o,folderInputRef:B,saveToDatabase:()=>{T()}},ae=({folder:e})=>(console.log(e.fileType),s.jsx(s.Fragment,{children:e.fileType.includes("image")?s.jsx("input",{type:"image",src:e.url,width:"16px",style:{marginRight:"1rem"}}):s.jsx("i",{className:"fa fa-file"})}));return s.jsx(X.Provider,{value:le,children:s.jsxs("div",{className:i.foldersWrapper,children:[s.jsx(We,{createFolder:G,setShowFolderInput:_}),c?s.jsx(be,{selecting:c,setSelecting:k,handleSelectingAll:Z,deleteSelectedFolder:te}):s.jsx("div",{className:i.foldersBottomNav,children:s.jsx("button",{onClick:()=>{k(!0)},children:"Select Folders"})}),s.jsxs("div",{className:i.foldersBox,children:[s.jsx("div",{className:i.folderPathWrapper,children:s.jsx("h3",{children:$.map(e=>e.path=="Folders/"?s.jsx("span",{children:s.jsxs("span",{onClick:()=>{x(e.path),H(e)},children:[e.name," "]})},e.name+e.path):s.jsxs("span",{children:["/ ",s.jsxs("span",{onClick:()=>{x(e.path),H(e)},children:[e.name," "]})]},e.name+e.path))})}),s.jsxs("div",{className:N?i.folderInput:i.hideFolderInput,children:[s.jsx("i",{className:"fa fa-folder"}),s.jsx("input",{type:"text",ref:B,id:"folderInput",onBlur:()=>{_(!1),B.current.value=""},onKeyDown:e=>{G(e)}}),s.jsx("i",{className:`fa fa-close ${i.close}`,onClick:()=>{_(!1)}})]}),L==null?void 0:L.map((e,t)=>s.jsxs("label",{htmlFor:C!=null?e.id:null,className:e.type=="folder"?e.isSelected?`${i.selected} ${i.folder}`:`${i.folder}`:e.isSelected?`${i.selected} ${i.file}`:`${i.file}`,onDoubleClick:()=>{c||(b(e.name),d(e.id))},children:[s.jsx("input",{type:"checkbox",style:c?{display:"block"}:{display:"none"},checked:!!e.isSelected,onChange:()=>{c&&Y(e)}}),e.type=="folder"?s.jsx("i",{className:"fa fa-folder"}):s.jsx(ae,{folder:e}),C!=null&&y==e.id?s.jsx("input",{id:e.id,type:"text",value:C,onKeyDown:l=>{ee(l,e)},onBlur:()=>[b(null),d(null)],onChange:l=>{b(l.target.value)}}):s.jsx("span",{children:e.name}),e.type=="folder"?s.jsx("button",{className:i.open,onClick:()=>{se(e)},children:"Open"}):s.jsx("a",{className:i.open,href:e.url,children:"Open"})]},e.dateCreated))]})]})})};export{Re as default,X as foldersContext};
